<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chayagorn Kitchen Service</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Kanit', sans-serif; }
    .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
  </style>
</head>
<body class="bg-slate-50 min-h-screen">

  <div id="loading" class="fixed inset-0 z-50 flex items-center justify-center bg-white">
    <div class="text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
      <p class="mt-4 text-slate-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏£‡πà‡∏≠‡∏¢...</p>
    </div>
  </div>

  <div id="login-page" class="hidden flex flex-col items-center justify-center min-h-screen p-6">
    <div class="text-6xl mb-6">üë®‚Äçüç≥</div>
    <h1 class="text-3xl font-bold text-slate-800 mb-2">Chayagorn Kitchen</h1>
    <p class="text-slate-500 mb-8 text-center">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</p>
    <button onclick="liff.login()" class="w-full max-w-xs bg-[#06C755] text-white py-3 rounded-xl font-bold shadow-lg hover:opacity-90 transition">
      LINE Login
    </button>
  </div>

  <div id="app" class="hidden pb-20">
    <div class="bg-blue-600 text-white p-6 pb-20 rounded-b-[2.5rem] shadow-lg">
      <div class="flex justify-between items-center max-w-md mx-auto">
        <div>
          <p class="text-blue-100 text-sm">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</p>
          <h2 id="user-name" class="text-xl font-bold">Chef...</h2>
        </div>
        <img id="user-img" class="h-12 w-12 rounded-full border-2 border-white/30 shadow-md">
      </div>
    </div>

    <div class="max-w-md mx-auto -mt-12 px-4 space-y-6">
      
      <div class="grid grid-cols-2 gap-4">
        <div class="glass p-4 rounded-2xl shadow-sm text-center">
          <p class="text-slate-400 text-xs uppercase tracking-wider">‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
          <p id="stat-total" class="text-2xl font-bold text-blue-600">-</p>
        </div>
        <div class="glass p-4 rounded-2xl shadow-sm text-center border-b-4 border-green-500">
          <p class="text-slate-400 text-xs uppercase tracking-wider">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</p>
          <p id="stat-done" class="text-2xl font-bold text-green-600">-</p>
        </div>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
        <h3 class="font-bold text-slate-800 mb-4 flex items-center">
          <span class="mr-2">üìù</span> ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
        </h3>
        <form id="order-form" class="space-y-4">
          <input type="text" id="title" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á)" class="w-full bg-slate-50 border-none rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none" required>
          <textarea id="detail" rows="2" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô..." class="w-full bg-slate-50 border-none rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none"></textarea>
          <select id="type" class="w-full bg-slate-50 border-none rounded-xl p-3 outline-none">
            <option value="‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏Ø">‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏Ø</option>
            <option value="‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ">‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ</option>
            <option value="‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á">‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á</option>
          </select>
          <button type="submit" id="btn-submit" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-md hover:bg-blue-700 transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </form>
      </div>

      <div>
        <div class="flex justify-between items-center mb-4">
          <h3 class="font-bold text-slate-800">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
          <button onclick="fetchData()" class="text-blue-600 text-sm">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
        </div>
        <div id="data-list" class="space-y-3">
          </div>
      </div>

    </div>
  </div>

  <script>
    const LIFF_ID = '2008904245-TsV7LL73'; // ** ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbxelWNQWMsswiUwtqRqlFAUvlFUejdStFCMSwC2FpysqVJ7j0YfXYMnYpsr-AEGFtnULQ/exec'; // ** ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

    async function init() {
      try {
        await liff.init({ liffId: LIFF_ID });
        if (liff.isLoggedIn()) {
          showApp();
        } else {
          document.getElementById('loading').style.display = 'none';
          document.getElementById('login-page').style.display = 'flex';
        }
      } catch (err) { alert("LIFF Error: " + err); }
    }

    async function showApp() {
      const profile = await liff.getProfile();
      document.getElementById('user-name').innerText = profile.displayName + " (Chef)";
      document.getElementById('user-img').src = profile.pictureUrl;
      
      document.getElementById('loading').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      fetchData();
    }

    async function fetchData() {
      try {
        const res = await fetch(GAS_URL);
        const data = await res.json();
        renderList(data);
      } catch (err) { console.error("Fetch Error:", err); }
    }

    function renderList(rawData) {
      const rows = rawData.slice(1); // ‡∏ï‡∏±‡∏î Header
      const listContainer = document.getElementById('data-list');
      
      // Update Stats
      document.getElementById('stat-total').innerText = rows.length;
      document.getElementById('stat-done').innerText = rows.filter(r => r[8] === 'Done').length;

      if (rows.length === 0) {
        listContainer.innerHTML = '<p class="text-center text-slate-400 py-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
        return;
      }

      listContainer.innerHTML = rows.reverse().map(row => `
        <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-50 flex items-center justify-between">
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-1">
              <span class="text-[10px] px-2 py-0.5 rounded-full ${row[8] === 'Done' ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'} font-bold uppercase tracking-tighter">
                ${row[8]}
              </span>
              <span class="text-slate-300 text-[10px]">${new Date(row[1]).toLocaleDateString('th-TH')}</span>
            </div>
            <h4 class="font-bold text-slate-800 leading-tight">${row[4]}</h4>
            <p class="text-slate-500 text-xs mt-1 truncate w-48">${row[5] || '-'}</p>
          </div>
          <div class="text-right">
             <div class="text-blue-600 font-bold text-sm">Type ${row[9] || 'C'}</div>
             <div class="text-slate-300 text-[10px]">${row[0].split('-')[1].substring(0,5)}</div>
          </div>
        </div>
      `).join('');
    }

    document.getElementById('order-form').onsubmit = async (e) => {
      e.preventDefault();
      const btn = document.getElementById('btn-submit');
      btn.disabled = true;
      btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";

      const profile = await liff.getProfile();
      const payload = {
        lineId: profile.userId,
        name: profile.displayName,
        title: document.getElementById('title').value,
        detail: document.getElementById('detail').value,
        type: document.getElementById('type').value
      };

      try {
        await fetch(GAS_URL, {
          method: 'POST',
          body: JSON.stringify(payload)
        });
        alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
        document.getElementById('order-form').reset();
        fetchData();
      } catch (err) {
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
      } finally {
        btn.disabled = false;
        btn.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
      }
    };

    init();
  </script>
</body>
</html>